# 播客索引管理器 - 数据库表字段说明

本文档记录了播客索引管理器数据库的所有表结构及字段说明。

## 数据库信息

- **数据库类型**: PostgreSQL
- **连接地址**: `postgresql://admin:admin123@localhost:5432/podcast-index-manger`
- **Schema 文件**: `prisma/schema.prisma`
- **实体定义**: `docs/nestjs-entities/podcast-entities.ts`

## 表结构概览

本数据库包含以下 17 张表：

### 核心表

1. **podcasts** - 播客表
2. **episodes** - 节目表

### 同步管理表

3. **sync_logs** - 同步日志表
4. **sync_cursors** - 同步游标表
5. **sync_workers** - 同步工作进程表

### 分类和合集表

6. **categories** - 分类表
7. **podcast_categories** - 播客分类关联表
8. **podcast_collections** - 播客合集表
9. **podcast_collection_items** - 播客合集项目表

### 编辑和质量表

10. **podcast_editorials** - 播客编辑信息表
11. **quality_alerts** - 质量告警表

### Value for Value 相关表

12. **podcast_value_destinations** - 播客 Value for Value 收款地址表
13. **episode_value_destinations** - 节目 Value for Value 收款地址表

### 节目扩展表

14. **episode_transcripts** - 节目字幕表
15. **episode_persons** - 节目人物表
16. **episode_soundbites** - 节目精彩片段表
17. **episode_social_interactions** - 节目社交互动表

## 详细表结构

### 1. podcasts - 播客表

存储播客源的元数据信息。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| podcast_index_id | INTEGER | PodcastIndex平台的Feed ID |
| podcast_guid | VARCHAR | 播客全局唯一标识符 |
| title | VARCHAR | 播客标题 |
| url | VARCHAR | RSS订阅地址 |
| original_url | VARCHAR | 原始订阅地址 |
| link | VARCHAR | 播客网站链接 |
| description | TEXT | 播客描述 |
| author | VARCHAR | 作者 |
| owner_name | VARCHAR | 所有者名称 |
| owner_email | VARCHAR | 所有者邮箱 |
| image | VARCHAR | 图片URL |
| artwork | VARCHAR | 封面图URL |
| last_update_time | TIMESTAMP | 最后更新时间 |
| last_crawl_time | TIMESTAMP | 最后抓取时间 |
| last_parse_time | TIMESTAMP | 最后解析时间 |
| last_good_http_status_time | TIMESTAMP | 最后HTTP状态正常的时间 |
| last_http_status | INTEGER | 最后HTTP状态码 |
| content_type | VARCHAR | 内容类型 |
| itunes_id | INTEGER | iTunes ID |
| itunes_type | VARCHAR | iTunes类型 |
| generator | VARCHAR | RSS生成器 |
| language | VARCHAR(64) | 语言代码 |
| explicit | BOOLEAN | 是否包含成人内容 |
| type | INTEGER | 播客类型 |
| medium | VARCHAR(32) | 媒体类型(如:podcast, music, video) |
| dead | INTEGER | 是否已失效(0=正常,1=失效) |
| priority | INTEGER | 优先级 |
| in_polling_queue | BOOLEAN | 是否在轮询队列中 |
| chash | VARCHAR | 内容哈希值 |
| created_on | TIMESTAMP | PodcastIndex创建时间 |
| episode_count | INTEGER | 节目总数 |
| crawl_errors | INTEGER | 抓取错误次数 |
| parse_errors | INTEGER | 解析错误次数 |
| locked | BOOLEAN | 是否锁定 |
| image_url_hash | BIGINT | 图片URL哈希值 |
| oldest_item_pubdate | TIMESTAMP | 最早节目发布日期 |
| newest_item_pubdate | TIMESTAMP | 最新节目发布日期 |
| popularity | INTEGER | 热度值 |
| trend_score | INTEGER | 趋势分数 |
| duplicate_of_feed_id | INTEGER | 重复源的原始Feed ID |
| value_created_on | TIMESTAMP | Value for Value创建时间 |
| value_block | TEXT | Value for Value配置JSON |
| funding_url | VARCHAR | 赞助链接 |
| funding_message | VARCHAR | 赞助信息 |
| value_model_type | VARCHAR | 价值模型类型 |
| value_model_method | VARCHAR | 价值模型方法 |
| value_model_suggested | VARCHAR | 建议的价值模型 |
| created_at | TIMESTAMP | 本地创建时间 |
| updated_at | TIMESTAMP | 本地更新时间 |

**索引：**
- `podcasts_title_idx` (title)
- `podcasts_language_idx` (language)
- `podcasts_updated_idx` (updated_at DESC)
- `podcasts_index_id_idx` (podcast_index_id)
- `podcasts_itunes_idx` (itunes_id)

**唯一约束：**
- `podcast_index_id`
- `podcast_guid`
- `url`

### 2. episodes - 节目表

存储播客节目(Episode)的详细信息。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| podcast_id | INTEGER | 所属播客ID (外键 -> podcasts.id) |
| feed_id | INTEGER | PodcastIndex的Feed ID |
| podcast_index_id | BIGINT | PodcastIndex的Episode ID |
| guid | VARCHAR(512) | 节目GUID |
| title | VARCHAR | 节目标题 |
| description | TEXT | 节目描述 |
| link | VARCHAR | 节目链接 |
| date_published | TIMESTAMP | 发布日期 |
| date_crawled | TIMESTAMP | 抓取日期 |
| enclosure_url | TEXT | 音频文件URL |
| enclosure_type | VARCHAR(128) | 音频文件MIME类型 |
| enclosure_length | INTEGER | 音频文件大小(字节) |
| duration | INTEGER | 时长(秒) |
| explicit | BOOLEAN | 是否包含成人内容 |
| episode | INTEGER | 集数 |
| episode_type | VARCHAR(32) | 节目类型(full, trailer, bonus) |
| season | INTEGER | 季数 |
| image | VARCHAR | 节目封面URL |
| image_url_hash | BIGINT | 封面URL哈希值 |
| feed_itunes_id | INTEGER | 所属播客的iTunes ID |
| feed_image | VARCHAR | 播客封面URL |
| feed_image_url_hash | BIGINT | 播客封面URL哈希值 |
| feed_url | VARCHAR | 播客RSS地址 |
| feed_title | VARCHAR | 播客标题 |
| feed_author | VARCHAR | 播客作者 |
| feed_language | VARCHAR | 播客语言 |
| feed_dead | INTEGER | 播客是否失效 |
| feed_duplicate_of | INTEGER | 播客是否重复 |
| transcript_url | VARCHAR | 字幕文件URL |
| chapters_url | VARCHAR | 章节信息URL |
| content_link | VARCHAR | 内容链接 |
| start_time | TIMESTAMP | 直播开始时间 |
| end_time | TIMESTAMP | 直播结束时间 |
| status | VARCHAR(32) | 状态(live, ended, pending) |
| value_model_type | VARCHAR | 价值模型类型 |
| value_model_method | VARCHAR | 价值模型方法 |
| value_model_suggested | VARCHAR | 建议的价值模型 |
| value_created_on | TIMESTAMP | Value for Value创建时间 |
| created_at | TIMESTAMP | 本地创建时间 |
| updated_at | TIMESTAMP | 本地更新时间 |

**索引：**
- `episodes_podcast_published_idx` (podcast_id, date_published DESC)
- `episodes_published_idx` (date_published DESC)
- `episodes_title_idx` (title)
- `episodes_feed_idx` (feed_id)

**唯一约束：**
- `podcast_index_id`
- (podcast_id, guid) 联合唯一

### 3. sync_logs - 同步日志表

记录数据同步任务的执行情况。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| podcast_id | INTEGER | 关联的播客ID (外键 -> podcasts.id) |
| job_type | VARCHAR(64) | 任务类型 |
| status | ENUM | 任务状态 (PENDING, RUNNING, SUCCESS, FAILED) |
| queue_job_id | VARCHAR(64) | 队列任务ID |
| started_at | TIMESTAMP | 开始时间 |
| finished_at | TIMESTAMP | 结束时间 |
| payload | JSONB | 任务参数 |
| error | JSONB | 错误信息 |
| message | TEXT | 消息 |

**索引：**
- `sync_logs_status_started_idx` (status, started_at DESC)
- `sync_logs_podcast_started_idx` (podcast_id, started_at DESC)
- `sync_logs_queue_job_idx` (queue_job_id)

### 4. sync_cursors - 同步游标表

记录增量同步的位置。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | VARCHAR | 游标标识符 (主键) |
| cursor | VARCHAR | 游标值 |
| updated_at | TIMESTAMP | 更新时间 |

### 5. sync_workers - 同步工作进程表

记录同步工作进程的状态。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| name | VARCHAR(64) | 工作进程名称 |
| status | VARCHAR(32) | 工作进程状态 |
| last_seen | TIMESTAMP | 最后心跳时间 |
| details | JSONB | 详细信息 |
| created_at | TIMESTAMP | 创建时间 |

**索引：**
- `sync_workers_name_idx` (name)

### 6. categories - 分类表

存储播客分类信息。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 分类ID (主键) |
| name | VARCHAR | 分类名称 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

### 7. podcast_categories - 播客分类关联表

播客与分类的多对多关系。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| podcast_id | INTEGER | 播客ID (联合主键, 外键 -> podcasts.id) |
| category_id | INTEGER | 分类ID (联合主键, 外键 -> categories.id) |
| created_at | TIMESTAMP | 创建时间 |

**索引：**
- `podcast_categories_category_idx` (category_id)

### 8. podcast_collections - 播客合集表

用于组织播客集合。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| name | VARCHAR(128) | 合集名称 |
| description | TEXT | 合集描述 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

**唯一约束：**
- `name`

### 9. podcast_collection_items - 播客合集项目表

合集与播客的多对多关系。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| collection_id | INTEGER | 合集ID (联合主键, 外键 -> podcast_collections.id) |
| podcast_id | INTEGER | 播客ID (联合主键, 外键 -> podcasts.id) |
| position | INTEGER | 排序位置 |
| added_at | TIMESTAMP | 添加时间 |

**索引：**
- `collection_items_podcast_idx` (podcast_id)

### 10. podcast_editorials - 播客编辑信息表

存储编辑后的播客展示信息。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| podcast_id | INTEGER | 播客ID (主键, 外键 -> podcasts.id) |
| status | ENUM | 状态 (ACTIVE, PAUSED, ARCHIVED) |
| priority | ENUM | 优先级 (LOW, NORMAL, HIGH) |
| display_title | VARCHAR | 展示标题 |
| display_author | VARCHAR | 展示作者 |
| display_image | VARCHAR | 展示封面 |
| tags | TEXT[] | 标签数组 |
| notes | TEXT | 备注 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

### 11. quality_alerts - 质量告警表

记录数据质量问题。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| severity | VARCHAR(16) | 严重程度 (low, medium, high, critical) |
| title | VARCHAR | 告警标题 |
| description | TEXT | 告警描述 |
| status | VARCHAR(16) | 状态 (open, resolved) |
| metadata | JSONB | 元数据 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |
| resolved_at | TIMESTAMP | 解决时间 |

**索引：**
- `quality_alerts_status_idx` (status)

### 12. podcast_value_destinations - 播客 Value for Value 收款地址表

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| podcast_id | INTEGER | 播客ID (外键 -> podcasts.id) |
| name | VARCHAR | 收款人名称 |
| address | VARCHAR | 收款地址 |
| type | VARCHAR | 地址类型 (node, address) |
| split | INTEGER | 分成比例 |
| fee | BOOLEAN | 是否收取费用 |
| custom_key | VARCHAR | 自定义键 |
| custom_value | VARCHAR | 自定义值 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

**索引：**
- `podcast_value_destinations_podcast_idx` (podcast_id)

### 13. episode_value_destinations - 节目 Value for Value 收款地址表

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| episode_id | INTEGER | 节目ID (外键 -> episodes.id) |
| name | VARCHAR | 收款人名称 |
| address | VARCHAR | 收款地址 |
| type | VARCHAR | 地址类型 (node, address) |
| split | INTEGER | 分成比例 |
| fee | BOOLEAN | 是否收取费用 |
| custom_key | VARCHAR | 自定义键 |
| custom_value | VARCHAR | 自定义值 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

**索引：**
- `episode_value_destinations_episode_idx` (episode_id)

### 14. episode_transcripts - 节目字幕表

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| episode_id | INTEGER | 节目ID (外键 -> episodes.id) |
| url | VARCHAR | 字幕文件URL |
| type | VARCHAR | 字幕类型 (srt, vtt, json) |
| language | VARCHAR | 字幕语言 |
| rel | VARCHAR | 关系类型 (captions) |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

**索引：**
- `episode_transcripts_episode_idx` (episode_id)

**唯一约束：**
- (episode_id, url) 联合唯一

### 15. episode_persons - 节目人物表

记录节目中提到的人物。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| episode_id | INTEGER | 节目ID (外键 -> episodes.id) |
| person_index_id | INTEGER | 人物索引ID |
| name | VARCHAR | 人物姓名 |
| role | VARCHAR | 角色 (host, guest) |
| group_name | VARCHAR | 所属组织 |
| href | VARCHAR | 人物链接 |
| img | VARCHAR | 人物头像 |
| metadata | JSONB | 元数据 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

**索引：**
- `episode_persons_episode_idx` (episode_id)

### 16. episode_soundbites - 节目精彩片段表

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| episode_id | INTEGER | 节目ID (外键 -> episodes.id) |
| start_time | INTEGER | 开始时间(秒) |
| duration | INTEGER | 持续时长(秒) |
| title | VARCHAR | 片段标题 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

**索引：**
- `episode_soundbites_episode_idx` (episode_id)

### 17. episode_social_interactions - 节目社交互动表

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| episode_id | INTEGER | 节目ID (外键 -> episodes.id) |
| url | VARCHAR | 互动URL |
| protocol | VARCHAR | 协议 (activitypub, twitter) |
| account_id | VARCHAR | 账号ID |
| account_url | VARCHAR | 账号URL |
| priority | INTEGER | 优先级 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

**索引：**
- `episode_social_interactions_episode_idx` (episode_id)

## 枚举类型

### SyncStatus - 同步状态

- `PENDING` - 等待中
- `RUNNING` - 运行中
- `SUCCESS` - 成功
- `FAILED` - 失败

### PodcastEditorialStatus - 播客编辑状态

- `ACTIVE` - 激活
- `PAUSED` - 暂停
- `ARCHIVED` - 归档

### PodcastEditorialPriority - 播客编辑优先级

- `LOW` - 低
- `NORMAL` - 普通
- `HIGH` - 高

## 表关系图

```
podcasts (播客表)
├── episodes (1:N) - 节目
│   ├── episode_transcripts (1:N) - 字幕
│   ├── episode_persons (1:N) - 人物
│   ├── episode_soundbites (1:N) - 精彩片段
│   ├── episode_social_interactions (1:N) - 社交互动
│   └── episode_value_destinations (1:N) - Value收款地址
├── sync_logs (1:N) - 同步日志
├── podcast_categories (N:M) - 分类关联
│   └── categories
├── podcast_value_destinations (1:N) - Value收款地址
├── podcast_collection_items (N:M) - 合集关联
│   └── podcast_collections
└── podcast_editorial (1:1) - 编辑信息
```

## 更新日志

- **2025-10-20**: 初始版本，添加所有表的中文注释和完整的 NestJS 实体定义
